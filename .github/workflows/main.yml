name: Tests

on:
  push:
    branches: [main]
  pull_request:

env:
  DIFF_CMD: ./Tool/nbdiff_web_exporter.py
  DIFFHTML_DIR: diff_artifacts
  PORT: 8080
  NBDIME_VER: 4.0.1 
  SELENIUM_VER: 4.22.0 
  CHROMDRIVER_BINARY_VER: 126.0.6478.63.0 
  JUPYTER_SERVER_VER: 2.12.5

jobs:
  #build:
  #  runs-on: ${{ matrix.platform }}
  #  strategy:
  #    fail-fast: false
  #    matrix:
  #      # https://help.github.com/articles/virtual-environments-for-github-actions
  #      platform:
  #        - ubuntu-latest  # ubuntu-20.04
  #      python-version: [3.9]
 
  #  steps:
  #  - uses: actions/checkout@v3
  #  - name: Set up Python ${{ matrix.python-version }}
  #    uses: actions/setup-python@v4
  #    with:
  #      python-version: ${{ matrix.python-version }}
  #  - name: Install dependencies
  #    run: |
  #      python -m pip install --upgrade pip
  #      pip install tox==3.26.0 pytest nbdime==4.0.1

  notebook_diff:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout source tree
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
      #- uses: browser-actions/setup-chrome@v1
      #  id: setup-chrome
      #  with:
      #    chrome-version: 126
      #    install-dependencies: true
      #- run: |
      #    ${{ steps.setup-chrome.outputs.chrome-path }} --version
      ##- name: Setup Chrome and ChromeDriver
      ##  uses: ./.github/actions/setup-chrome
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install nbdime==${{ NBDIME_VER }} selenium==${{ SELENIUM_VER }} chromedriver_binary==${{ CHROMDRIVER_BINARY_VER }} jupyter_server==${{ JUPYTER_SERVER_VER }}
          pip install tox==3.26.0 pytest
          pip list
      ##- name: Install package
      ##  run: |
      ##    pip install .
      - name: diff notebooks
        id: make-notebook-diffhtmls
        run: |
          mkdir ${{ env.DIFFHTML_DIR }}
          python ${{ env.DIFF_CMD }} --export-dir ./${{ env.DIFFHTML_DIR }} --port ${{ env.PORT }}  origin/main origin/test Test1.ipynb
          #nbdiff-web-exporter --export-dir ./export-dir --port 8080  origin/main origin/test-data data/notebook.ipynb
          #python ./Tool/nbdiff_web_exporter.py --export-dir ./export_data --port 8080  main test Test1.ipynb
          #python ./Tool/nbdiff_web_exporter.py --export-dir ./export_data --port 8080 --browser ${{ steps.setup-chrome.outputs.chrome-path }} origin/main origin/test Test1.ipynb
          #python ./Tool/nbdiff_web_exporter.py --export-dir ./export_data --port 8080 --browser disabled origin/main origin/test Test1.ipynb
          #python ./Tool/nbdiff_web_exporter.py --export-dir ./export_data --port 8080 --browser chrome origin/main origin/test Test1.ipynb
      #- name: check diff file is exists.
      #  run: |
      #    #ls ./export-dir/data/notebook.html
      #    ls ./export_data/Test1.html
      - uses: actions/upload-artifact@v4
        with:
          name: notebook_diffhtmls
          #path: ${{steps.make-notebook-diffhtmls.outputs.export_dir}}
          path: ./${{ env.DIFFHTML_DIR }}/Test1.html
